<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>sql解密存儲過程 | Seth Dang&#39;S</title>
<meta name="keywords" content="">
<meta name="description" content="CREATE PROCEDURE sp_decrypt(@objectName varchar(50))
AS
begin
set nocount on
begin tran
declare @objectname1 varchar(100),@orgvarbin varbinary(8000)
declare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)
DECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)
declare @i int,@status int,@type varchar(10),@parentid int
declare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int
select @type=xtype,@parentid=parent_obj from sysobjects where
create table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)
insert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)
select @number=max(number) from #temp
set @k=0">
<meta name="author" content="Seth">
<link rel="canonical" href="seth.dpdns.org/posts/sql%E8%A7%A3%E5%AF%86%E5%AD%98%E5%84%B2%E9%81%8E%E7%A8%8B/">
<link crossorigin="anonymous" href="seth.dpdns.org/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css" integrity="sha256-4fXEyuRFmWVff/lRlf&#43;JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as="style">
<link rel="icon" href="seth.dpdns.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="seth.dpdns.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="seth.dpdns.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="seth.dpdns.org/apple-touch-icon.png">
<link rel="mask-icon" href="seth.dpdns.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="seth.dpdns.org/posts/sql%E8%A7%A3%E5%AF%86%E5%AD%98%E5%84%B2%E9%81%8E%E7%A8%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="seth.dpdns.org/posts/sql%E8%A7%A3%E5%AF%86%E5%AD%98%E5%84%B2%E9%81%8E%E7%A8%8B/">
  <meta property="og:site_name" content="Seth Dang&#39;S">
  <meta property="og:title" content="sql解密存儲過程">
  <meta property="og:description" content="CREATE PROCEDURE sp_decrypt(@objectName varchar(50))
AS
begin
set nocount on
begin tran
declare @objectname1 varchar(100),@orgvarbin varbinary(8000)
declare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)
DECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)
declare @i int,@status int,@type varchar(10),@parentid int
declare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int
select @type=xtype,@parentid=parent_obj from sysobjects where
create table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)
insert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)
select @number=max(number) from #temp
set @k=0">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2007-02-04T14:21:41+08:00">
    <meta property="article:modified_time" content="2007-02-04T14:21:41+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sql解密存儲過程">
<meta name="twitter:description" content="CREATE PROCEDURE sp_decrypt(@objectName varchar(50))
AS
begin
set nocount on
begin tran
declare @objectname1 varchar(100),@orgvarbin varbinary(8000)
declare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)
DECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)
declare @i int,@status int,@type varchar(10),@parentid int
declare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int
select @type=xtype,@parentid=parent_obj from sysobjects where
create table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)
insert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)
select @number=max(number) from #temp
set @k=0">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "seth.dpdns.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "sql解密存儲過程",
      "item": "seth.dpdns.org/posts/sql%E8%A7%A3%E5%AF%86%E5%AD%98%E5%84%B2%E9%81%8E%E7%A8%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "sql解密存儲過程",
  "name": "sql解密存儲過程",
  "description": "CREATE PROCEDURE sp_decrypt(@objectName varchar(50))\nAS\nbegin\nset nocount on\nbegin tran\ndeclare @objectname1 varchar(100),@orgvarbin varbinary(8000)\ndeclare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)\nDECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)\ndeclare @i int,@status int,@type varchar(10),@parentid int\ndeclare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int\nselect @type=xtype,@parentid=parent_obj from sysobjects where\ncreate table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)\ninsert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)\nselect @number=max(number) from #temp\nset @k=0\n",
  "keywords": [
    
  ],
  "articleBody": "CREATE PROCEDURE sp_decrypt(@objectName varchar(50))\nAS\nbegin\nset nocount on\nbegin tran\ndeclare @objectname1 varchar(100),@orgvarbin varbinary(8000)\ndeclare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)\nDECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)\ndeclare @i int,@status int,@type varchar(10),@parentid int\ndeclare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int\nselect @type=xtype,@parentid=parent_obj from sysobjects where\ncreate table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)\ninsert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)\nselect @number=max(number) from #temp\nset @k=0\nwhile @k\u003c=@number\nbegin\nif exists(select 1 from syscomments where and number=@k)\nbegin\nif @type=‘P’\nset @sql1=(case when @number\u003e1 then ‘ALTER PROCEDURE ‘+ @objectName +’;’+rtrim(@k)+’ WITH ENCRYPTION AS ’\nelse ‘ALTER PROCEDURE ‘+ @objectName+’ WITH ENCRYPTION AS ’\nend)\nif @type=‘TR’\nbegin\ndeclare @parent_obj varchar(255),@tr_parent_xtype varchar(10)\nselect @parent_obj=parent_obj from sysobjects where\nselect @tr_parent_xtype=xtype from sysobjects where id=@parent_obj\nif @tr_parent_xtype=‘V’\nbegin\nset @sql1=‘ALTER TRIGGER ’+@objectname+’ ON ‘+OBJECT_NAME(@parentid)+’ WITH ENCRYPTION INSTERD OF INSERT AS PRINT 1 ’\nend\nelse\nbegin\nset @sql1=‘ALTER TRIGGER ’+@objectname+’ ON ‘+OBJECT_NAME(@parentid)+’ WITH ENCRYPTION FOR INSERT AS PRINT 1 ’\nend\nend\nif @type=‘FN’ or @type=‘TF’ or @type=‘IF’\nset @sql1=(case @type when ‘TF’ then\n‘ALTER FUNCTION ‘+ @objectName+’(@a char(1)) returns @b table(a varchar(10)) with encryption as begin insert @b select @a return end ’\nwhen ‘FN’ then\n‘ALTER FUNCTION ‘+ @objectName+’(@a char(1)) returns char(1) with encryption as begin return @a end’\nwhen ‘IF’ then\n‘ALTER FUNCTION ‘+ @objectName+’(@a char(1)) returns table with encryption as return select @a as a’\nend)\nif @type=‘V’\nset @sql1=‘ALTER VIEW ’+@objectname+’ WITH ENCRYPTION AS SELECT 1 as f’\nset @q=len(@sql1)\nset @sql1=@sql1+REPLICATE(’-’,4000-@q)\nselect @sql2=REPLICATE(’-’,8000)\nset @sql3=‘exec(@sql1’\nselect @colid=max(colid) from #temp where number=@k\nset @n=1\nwhile @n\u003c=CEILING(1.0*(@colid-1)/2) and len(@sQL3)\u003c=3996\nbegin\nset @sql3=@sql3+’+@’\nset @n=@n+1\nend\nset @sql3=@sql3+’)’\nexec sp_executesql @sql3,N’@Sql1 nvarchar(4000),@ varchar(8000)’,@sql1=@sql1,@=@sql2\nend\nset @k=@k+1\nend\nset @k=0\nwhile @k\u003c=@number\nbegin\nif exists(select 1 from syscomments where and number=@k)\nbegin\nselect @colid=max(colid) from #temp where number=@k\nset @n=1\nwhile @n\u003c=@colid\nbegin\nselect @OrigSpText1=ctext,@encrypted=encrypted,@status=status FROM #temp WHERE colid=@n and number=@k\nSET @OrigSpText3=(SELECT ctext FROM syscomments WHERE and colid=@n and number=@k)\nif @n=1\nbegin\nif @type=‘P’\nSET @OrigSpText2=(case when @number\u003e1 then ‘CREATE PROCEDURE ‘+ @objectName +’;’+rtrim(@k)+’ WITH ENCRYPTION AS ’\nelse ‘CREATE PROCEDURE ‘+ @objectName +’ WITH ENCRYPTION AS ’\nend)\nif @type=‘FN’ or @type=‘TF’ or @type=‘IF’\nSET @OrigSpText2=(case @type when ‘TF’ then\n‘CREATE FUNCTION ‘+ @objectName+’(@a char(1)) returns @b table(a varchar(10)) with encryption as begin insert @b select @a return end ’\nwhen ‘FN’ then\n‘CREATE FUNCTION ‘+ @objectName+’(@a char(1)) returns char(1) with encryption as begin return @a end’\nwhen ‘IF’ then\n‘CREATE FUNCTION ‘+ @objectName+’(@a char(1)) returns table with encryption as return select @a as a’\nend)\nif @type=‘TR’\nbegin\nif @tr_parent_xtype=‘V’\nbegin\nset @OrigSpText2=‘CREATE TRIGGER ’+@objectname+’ ON ‘+OBJECT_NAME(@parentid)+’ WITH ENCRYPTION INSTEAD OF INSERT AS PRINT 1 ’\nend\nelse\nbegin\nset @OrigSpText2=‘CREATE TRIGGER ’+@objectname+’ ON ‘+OBJECT_NAME(@parentid)+’ WITH ENCRYPTION FOR INSERT AS PRINT 1 ’\nend\nend\nif @type=‘V’\nset @OrigSpText2=‘CREATE VIEW ’+@objectname+’ WITH ENCRYPTION AS SELECT 1 as f’\nset @q=4000-len(@OrigSpText2)\nset @OrigSpText2=@OrigSpText2+REPLICATE(’-’,@q)\nend\nelse\nbegin\nSET @OrigSpText2=REPLICATE(’-’, 4000)\nend\nSET @i=1\nSET @resultsp = replicate(N’A’, (datalength(@OrigSpText1) / 2))\nWHILE @i\u003c=datalength(@OrigSpText1)/2\nBEGIN\nSET @resultsp = stuff(@resultsp, @i, 1, NCHAR(UNICODE(substring(@OrigSpText1, @i, 1)) ^\n(UNICODE(substring(@OrigSpText2, @i, 1)) ^\nUNICODE(substring(@OrigSpText3, @i, 1)))))\nSET @i=@i+1\nEND\nset @orgvarbin=cast(@OrigSpText1 as varbinary(8000))\nset @resultsp=(case when @encrypted=1\nthen @resultsp\nelse convert(nvarchar(4000),case when @status\u00262=2 then uncompress(@orgvarbin) else @orgvarbin end)\nend)\nprint @resultsp\nset @n=@n+1\nend\nend\nset @k=@k+1\nend\ndrop table #temp\nrollback tran\nend\n",
  "wordCount" : "558",
  "inLanguage": "en",
  "datePublished": "2007-02-04T14:21:41+08:00",
  "dateModified": "2007-02-04T14:21:41+08:00",
  "author":{
    "@type": "Person",
    "name": "Seth"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "seth.dpdns.org/posts/sql%E8%A7%A3%E5%AF%86%E5%AD%98%E5%84%B2%E9%81%8E%E7%A8%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Seth Dang'S",
    "logo": {
      "@type": "ImageObject",
      "url": "seth.dpdns.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="seth.dpdns.org/" accesskey="h" title="Seth Dang&#39;S (Alt + H)">Seth Dang&#39;S</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      sql解密存儲過程
    </h1>
    <div class="post-meta"><span title='2007-02-04 14:21:41 +0800 +0800'>February 4, 2007</span>&nbsp;·&nbsp;Seth

</div>
  </header> 
  <div class="post-content"><p>CREATE PROCEDURE sp_decrypt(@objectName varchar(50))<br>
AS<br>
begin<br>
set nocount on<br>
begin tran<br>
declare @objectname1 varchar(100),@orgvarbin varbinary(8000)<br>
declare @sql1 nvarchar(4000),@sql2 varchar(8000),@sql3 nvarchar(4000),@sql4 nvarchar(4000)<br>
DECLARE @OrigSpText1 nvarchar(4000), @OrigSpText2 nvarchar(4000) , @OrigSpText3 nvarchar(4000), @resultsp nvarchar(4000)<br>
declare @i int,@status int,@type varchar(10),@parentid int<br>
declare @colid int,@n int,@q int,@j int,@k int,@encrypted int,@number int<br>
select @type=xtype,@parentid=parent_obj from sysobjects where</p>
<p>create table #temp(number int,colid int,ctext varbinary(8000),encrypted int,status int)<br>
insert #temp SELECT number,colid,ctext,encrypted,status FROM syscomments WHERE id = object_id(@objectName)<br>
select @number=max(number) from #temp<br>
set @k=0</p>
<p>while @k&lt;<a href="mailto:=@number">=@number</a><br>
begin<br>
if exists(select 1 from syscomments where and <a href="mailto:number=@k">number=@k</a>)<br>
begin<br>
if @type=&lsquo;P&rsquo;<br>
set @sql1=(case when @number&gt;1 then &lsquo;ALTER PROCEDURE &lsquo;+ @objectName +&rsquo;;&rsquo;+rtrim(@k)+&rsquo; WITH ENCRYPTION AS &rsquo;<br>
else &lsquo;ALTER PROCEDURE &lsquo;+ @objectName+&rsquo; WITH ENCRYPTION AS &rsquo;<br>
end)</p>
<p>if @type=&lsquo;TR&rsquo;<br>
begin<br>
declare @parent_obj varchar(255),@tr_parent_xtype varchar(10)<br>
select @parent_obj=parent_obj from sysobjects where<br>
select @tr_parent_xtype=xtype from sysobjects where <a href="mailto:id=@parent_obj">id=@parent_obj</a><br>
if @tr_parent_xtype=&lsquo;V&rsquo;<br>
begin<br>
set @sql1=&lsquo;ALTER TRIGGER <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> ON &lsquo;+OBJECT_NAME(@parentid)+&rsquo; WITH ENCRYPTION INSTERD OF INSERT AS PRINT 1 &rsquo;<br>
end<br>
else<br>
begin<br>
set @sql1=&lsquo;ALTER TRIGGER <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> ON &lsquo;+OBJECT_NAME(@parentid)+&rsquo; WITH ENCRYPTION FOR INSERT AS PRINT 1 &rsquo;<br>
end</p>
<p>end<br>
if @type=&lsquo;FN&rsquo; or @type=&lsquo;TF&rsquo; or @type=&lsquo;IF&rsquo;<br>
set @sql1=(case @type when &lsquo;TF&rsquo; then<br>
&lsquo;ALTER FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns @b table(a varchar(10)) with encryption as begin insert @b select @a return end &rsquo;<br>
when &lsquo;FN&rsquo; then<br>
&lsquo;ALTER FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns char(1) with encryption as begin return @a end&rsquo;<br>
when &lsquo;IF&rsquo; then<br>
&lsquo;ALTER FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns table with encryption as return select @a as a&rsquo;<br>
end)</p>
<p>if @type=&lsquo;V&rsquo;<br>
set @sql1=&lsquo;ALTER VIEW <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> WITH ENCRYPTION AS SELECT 1 as f&rsquo;</p>
<p>set @q=len(@sql1)<br>
set @sql1=@sql1+REPLICATE(&rsquo;-&rsquo;,4000-@q)<br>
select @sql2=REPLICATE(&rsquo;-&rsquo;,8000)<br>
set @sql3=&lsquo;exec(@sql1&rsquo;<br>
select @colid=max(colid) from #temp where <a href="mailto:number=@k">number=@k</a><br>
set @n=1<br>
while @n&lt;=CEILING(1.0*(@colid-1)/2) and len(@sQL3)&lt;=3996<br>
begin<br>
set @sql3=@sql3+&rsquo;+@&rsquo;<br>
set @n=@n+1<br>
end<br>
set @sql3=@sql3+&rsquo;)&rsquo;<br>
exec sp_executesql @sql3,N&rsquo;@Sql1 nvarchar(4000),@ varchar(8000)&rsquo;,@sql1=@sql1,@=@sql2</p>
<p>end<br>
set @k=@k+1<br>
end</p>
<p>set @k=0<br>
while @k&lt;<a href="mailto:=@number">=@number</a><br>
begin</p>
<p>if exists(select 1 from syscomments where and <a href="mailto:number=@k">number=@k</a>)<br>
begin<br>
select @colid=max(colid) from #temp where <a href="mailto:number=@k">number=@k</a><br>
set @n=1</p>
<p>while @n&lt;<a href="mailto:=@colid">=@colid</a><br>
begin<br>
select @OrigSpText1=ctext,@encrypted=encrypted,@status=status FROM #temp WHERE <a href="mailto:colid=@n">colid=@n</a> and <a href="mailto:number=@k">number=@k</a></p>
<p>SET @OrigSpText3=(SELECT ctext FROM syscomments WHERE and <a href="mailto:colid=@n">colid=@n</a> and <a href="mailto:number=@k">number=@k</a>)<br>
if @n=1<br>
begin<br>
if @type=&lsquo;P&rsquo;<br>
SET @OrigSpText2=(case when @number&gt;1 then &lsquo;CREATE PROCEDURE &lsquo;+ @objectName +&rsquo;;&rsquo;+rtrim(@k)+&rsquo; WITH ENCRYPTION AS &rsquo;<br>
else &lsquo;CREATE PROCEDURE &lsquo;+ @objectName +&rsquo; WITH ENCRYPTION AS &rsquo;<br>
end)</p>
<p>if @type=&lsquo;FN&rsquo; or @type=&lsquo;TF&rsquo; or @type=&lsquo;IF&rsquo;<br>
SET @OrigSpText2=(case @type when &lsquo;TF&rsquo; then<br>
&lsquo;CREATE FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns @b table(a varchar(10)) with encryption as begin insert @b select @a return end &rsquo;<br>
when &lsquo;FN&rsquo; then<br>
&lsquo;CREATE FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns char(1) with encryption as begin return @a end&rsquo;<br>
when &lsquo;IF&rsquo; then<br>
&lsquo;CREATE FUNCTION &lsquo;+ @objectName+&rsquo;(@a char(1)) returns table with encryption as return select @a as a&rsquo;<br>
end)</p>
<p>if @type=&lsquo;TR&rsquo;<br>
begin</p>
<p>if @tr_parent_xtype=&lsquo;V&rsquo;<br>
begin<br>
set @OrigSpText2=&lsquo;CREATE TRIGGER <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> ON &lsquo;+OBJECT_NAME(@parentid)+&rsquo; WITH ENCRYPTION INSTEAD OF INSERT AS PRINT 1 &rsquo;<br>
end<br>
else<br>
begin<br>
set @OrigSpText2=&lsquo;CREATE TRIGGER <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> ON &lsquo;+OBJECT_NAME(@parentid)+&rsquo; WITH ENCRYPTION FOR INSERT AS PRINT 1 &rsquo;<br>
end</p>
<p>end</p>
<p>if @type=&lsquo;V&rsquo;<br>
set @OrigSpText2=&lsquo;CREATE VIEW <a href="mailto:'+@objectname+'">&rsquo;+@objectname+&rsquo;</a> WITH ENCRYPTION AS SELECT 1 as f&rsquo;</p>
<p>set @q=4000-len(@OrigSpText2)<br>
set @OrigSpText2=@OrigSpText2+REPLICATE(&rsquo;-&rsquo;,@q)<br>
end<br>
else<br>
begin<br>
SET @OrigSpText2=REPLICATE(&rsquo;-&rsquo;, 4000)<br>
end<br>
SET @i=1</p>
<p>SET @resultsp = replicate(N&rsquo;A&rsquo;, (datalength(@OrigSpText1) / 2))</p>
<p>WHILE @i&lt;=datalength(@OrigSpText1)/2<br>
BEGIN</p>
<p>SET @resultsp = stuff(@resultsp, @i, 1, NCHAR(UNICODE(substring(@OrigSpText1, @i, 1)) ^<br>
(UNICODE(substring(@OrigSpText2, @i, 1)) ^<br>
UNICODE(substring(@OrigSpText3, @i, 1)))))<br>
SET @i=@i+1<br>
END<br>
set @orgvarbin=cast(@OrigSpText1 as varbinary(8000))<br>
set @resultsp=(case when @encrypted=1<br>
then @resultsp<br>
else convert(nvarchar(4000),case when @status&amp;2=2 then uncompress(@orgvarbin) else @orgvarbin end)<br>
end)<br>
print @resultsp</p>
<p>set @n=@n+1</p>
<p>end</p>
<p>end<br>
set @k=@k+1<br>
end</p>
<p>drop table #temp<br>
rollback tran<br>
end</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="seth.dpdns.org/">Seth Dang&#39;S</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
