<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WINDOWS的域和活动目录 | Seth Dang&#39;S</title>
<meta name="keywords" content="">
<meta name="description" content="一、认识Windows 的域
本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。
一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。
从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户
名和密码登录。
二、构建Windows 2000 的域
这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。
说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个
CPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。
1、系统要求
*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。">
<meta name="author" content="Seth">
<link rel="canonical" href="seth.dpdns.org/posts/windows%E7%9A%84%E5%9F%9F%E5%92%8C%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/">
<link crossorigin="anonymous" href="seth.dpdns.org/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css" integrity="sha256-4fXEyuRFmWVff/lRlf&#43;JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as="style">
<link rel="icon" href="seth.dpdns.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="seth.dpdns.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="seth.dpdns.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="seth.dpdns.org/apple-touch-icon.png">
<link rel="mask-icon" href="seth.dpdns.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="seth.dpdns.org/posts/windows%E7%9A%84%E5%9F%9F%E5%92%8C%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="seth.dpdns.org/posts/windows%E7%9A%84%E5%9F%9F%E5%92%8C%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/">
  <meta property="og:site_name" content="Seth Dang&#39;S">
  <meta property="og:title" content="WINDOWS的域和活动目录">
  <meta property="og:description" content="一、认识Windows 的域
本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。
一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。
从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户
名和密码登录。
二、构建Windows 2000 的域
这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。
说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个
CPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。
1、系统要求
*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2006-12-09T16:28:55+08:00">
    <meta property="article:modified_time" content="2006-12-09T16:28:55+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WINDOWS的域和活动目录">
<meta name="twitter:description" content="一、认识Windows 的域
本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。
一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。
从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户
名和密码登录。
二、构建Windows 2000 的域
这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。
说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个
CPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。
1、系统要求
*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "seth.dpdns.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "WINDOWS的域和活动目录",
      "item": "seth.dpdns.org/posts/windows%E7%9A%84%E5%9F%9F%E5%92%8C%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WINDOWS的域和活动目录",
  "name": "WINDOWS的域和活动目录",
  "description": "一、认识Windows 的域\n本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。\n一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。\n从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户\n名和密码登录。\n二、构建Windows 2000 的域\n这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。\n说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个\nCPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。\n1、系统要求\n*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。\n",
  "keywords": [
    
  ],
  "articleBody": "一、认识Windows 的域\n本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。\n一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。\n从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户\n名和密码登录。\n二、构建Windows 2000 的域\n这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。\n说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个\nCPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。\n1、系统要求\n*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。\n其上必须有一个NTFS 5.0 分区，用来保存AD 的sysvol 文件夹。注意：2000 的NTFS 分区是NTFS 5.0，NT4 的是NTFS 4.0，NT4 必须安装SP4 后，才可访问2000 的NTFS 分区。 网络上必须有可用的DNS 服务器，并且必须支持SRV 记录（Service Locaion Resource Record）和动态更新功能。如：MS Win2000S DNS，UNIX 的DNS BIND 8.12 及以上版本，使用已有的NT4 DNS 是不行的。\n说明：\n构建NT4 域并不需要DNS 的支持，但2000 域必须有DNS，且满足上述要求。SRV 记录的作用是指明域和站点（site）的DC、PDC 仿真、GC 是谁。动态更新也是2000DNS的新特色，管理员不必再象NT4 DNS 那样手动为计算机创建或修改相应记录，在域成员计算机\n重启，或改名、改IP 时依赖周期性更新，自动动态实现。\n如果没有DNS 服务器的话，也不一定非得预装DNS，可以在安装AD 过程中，选择在本机上安装2000 DNS。而且推荐初学者使用这种方法，因为系统会根据你提供的FQDN 域名，自动创建好DNS 区域（zone），并配置成AD 集成区域，仅安全动态更新。如果需要向外连或反向\n解析，用户只需配置上转发器和反向区域即可，不需要的话，直接就可以用了。如果决定在安装AD 过程中在本机安装DNS，应在安装前，将本机TCP/IP 配置/DNS 服务器指向自己，这样在安装AD 完成后重启时，SRV 记录将被自动注册到DNS 服务器的区域当中\n去的，生成四个以下划线开头的文件夹，如_msdcs，03DNS 在这里夹的层次结构有所变化，但本质没变。当然如果忘了指，也可以后补上，只不过需要多重启一次。\n2、安装步骤、注意事项、常见问题、经验技巧\n（1）启动AD 安装向导\n方法一：开始/程序/管理工具/配置服务器/ Active Directory /启动AD 安装向导。\n方法二：熟练后一般常用，开始/运行：dcpromo。\n（2）安装选项：指定服务器角色\n三个界面，实现四种组合：\n新域\n附加DC\n新树\n子域\n新林\n加入林\n即： 新域—新树—新林 附加DC 新域—子域 新域—新树—加入林\n全新安装：新域—新树—新林，这样来建立第一个域中的第一台DC。\n2000 的多域模型采用层次结构，不同于NT4 域的平面结构，NT4 的多个域之间只是通过信任关系关联起来。接下来以下图为例，对2000 的域、树、林进行简要说明：\nms.com\n/\ntrainning.mcse.com lotus.com\n这整个是一个林，ms.com 为林根域，有两个树，一个由ms.com 和它的子域trainning.ms.com组成，另一个由lotus.com 单独组成，林中有ms.com，trainning.ms.com，lotus.com 三个域。相关\n概念如下：\n林根域：在林中第一个建立的域，如：ms.com\n树：共用连续的命名空间的多层域，如ms.com 和trainning.ms.com\n树根域：树最高层的域，名最短。如：ms.com\n说明：\n2000 可采用多层域结构，但最有效、最简便的管理方法仍是单域，所以大家在实际工作中要记住一个原则“能用单域解决，就不用多域＂。再者2000AD 是针对大中型网络设计的，而我们一般管理的网络也就几百个节点，属于小型网络，一般来讲用一个单域结构就够用了，不要人为将管理环境复杂化。在实验中，我们甚至可以一个林中只有一个树，一个树中只有一个域，一个域里只有一台DC。\n另外前面已经说过了，域是逻辑分组，与网络的物理拓扑无关，不要总试图规划一个子网\n一个域。当然实际中多个子网一个域，子网中若有95/98/NT 老计算机，无法利用DNS 直接登录到域，可以安装一台WINS 服务器解决问题。将所有计算机，包括WINS 服务器本身的TCP/IP\n配置中的WINS 服务器指向此WINS 服务器即可。\n（3）安装选项：新域的DNS 全名\n说明：\n在这里应该输入新域的完全有效域名FQDN，形如：mcse.com。系统会打算以mcse 作为此\n域的NetBIOS 名称，并在网络中检查是否存在重名，需要等一会儿。不重名则设为mcse，建议用户不要修改此名；重名则设为mcse0，建议用户最好换个名字。这也就是说，网络中如果已有一个域，名字叫做mcse.org，也会出现NetBIOS 名称冲突的问题。\n（4）安装选项：为新域指定一个NetBIOS 名称\n说明：\nNetBIOS 名称，只是为95/98/NT 等老版本用户通过“浏览服务＂或WINS 来识别这个域用的，如果确信域用户都是2000 及以上系统（它们通过DNS 定位域），其实NetBIOS 名称冲不冲突，都无所谓。\n（5）安装选项：指定AD 库和日志文件位置\n说明：\n如果仅是实验，用默认值即可。若是在真正的服务器上，都会有多块物理硬盘，最好分开存放，以提高性能。另外需要强调的是：AD 库和日志文件并不要求非得NTFS 5.0 分区，很多2000/03 书在此语焉不详。\n（6）安装选项：指定sysvol 文件夹位置\n说明：\n是sysvol 这个文件夹要求必须得NTFS 5.0 分区。在它当中存储有DC 间AD 要同步的内容，包括组策略的设置值。\n（7）这时网络中若无可用DNS 服务器，就会出现提示：找不到DNS 服务器，需要考虑在本机上安装一个DNS 服务器。可先不必理会，点“确定＂，接下来选“是，在本机上安装并配置DNS＂。初学者在此不要选“否，我将自己安装并配置DNS＂。\n（8）几分后，安装完成，需要重启。\n说明：\n若硬盘或网络上没有可用的2000S 源文件，会提示要2000S 光盘。\n最好用新装2000S 来安装AD，这样不容易出问题。如果你是用一个台运行了一段时间的2000S/AS，来安装AD，使其成为DC。重启及登录时可能会很慢（有时可能长达20 分钟），这是较常见的现象。一般2-3 次以后就好了，如果多次重启后还那样，那就要重装系统及AD 了。\n3、域成员计算机\n（1）将计算机加入到域\n首先将客户机TCP/IP 配置中所配的DNS 服务器，指向DC 所用的DNS 服务器。然后我的\n电脑/右键/属性/网络标识/属性/隶属于，选择域：输入域名，确定。提示输入用户口和口令，确定后提示重启。\n说明：\n加入域时，如果输入的域名为FQDN 格式，形如mcse.com，必须利用DNS 中的SRV 记录\n来找到DC，如果客户机的DNS 指的不对，就无法加入到域。\n加入域时，如果输入的域名为NetBIOS 格式，如mcse，也可以利用浏览服务（广播方式）\n直接找到DC，但它不是一个完善的服务，有时就会不好使。\n这样虽然也可把计算机加入到域，而且在等较长时间后也可以登录到域上去，但不推荐。因为客户机的DNS 指的不对，则它无法利用2000DNS 的动态更新动能，也就是说无法在DNS区域中自动生成关于这台计算机的A 记录和PTR 记录。那么同一域另一子网的2000 及以上计算机就无法利用DNS 找到它，这本应是可以的。\n再者，管理员无法在客户机上利用域的管理工具来远程管理域，因为这些管理工具必须使用DNS，出错提示：找不到域命名信息（有时客户机的DNS Client 服务有问题也会出现上述提\n示，重启服务即可）。这种情况下，要进行远程管理，就只能利用TS（终端服务）基于IP 来连了。\n当然用户也可以手动配置WINS 或Lmhosts 文件，来查找DC。这主要用于95/98/NT 老版本计算机跨子网（路由）查找DC 或加入域，因为这些老版本计算机无法利用DNS 来查找DC，浏览服务又是广播方式，只能在本网段进行，因为广播信息是无法通过路由器的，RFC1542 标\n准的路由器，可设置成允许DHCP 的广播数据通过，仅是一个特例。需要说明的是：95/98 可以使用域用户帐号登录到域，但并不能加入到域，在AD 中也没有计算机帐号，而NT 可以。计算机加入域成功后，未重启，即已在AD 用户和计算机/computer 容器下生成计算机帐号\n了，实验中查看时，需要手动刷新一下。而在DNS 中记录必须在计算机重启后（不必登录）或15 分钟后才能自动注册或更新到DNS 区域。但若我们平常修改一个计算机的名字或IP，要马上更新到DNS 区域，倒不一定非得重启，可利用ipconfig /registerdns 命令就行。明白以上讨论可用于排错，不一定非得重启登录后才知道结果。\n加入到NT4 域时，需要有管理特权才行；从Windows 2000 开始，微软作了改进：在Windows2000/03 域中，默认Authenticated Users 即可在域中最多创建 10 个计算机帐户。Authenticated Users\n指被验证的用户组，也就是说任何经过身份验证的普通域用户都可以加最多10 台计算机到域。\n常见问题：在实际中用普通域帐号加计算机到域，有时会不好使，原因是同名计算机帐号（极\n可能是它自己已经失效的计算机帐号）已存在而无权覆盖，这时就得用域管理员帐号了。\n（2）在加入域的计算机上，用域用户帐号登录到域。\n说明：\n在域中的非DC 计算机上，可以选择登录到域或本机，这是因为它同时还拥有本地用户帐号。而在DC 上只能选择登录到域了，因为整个域都是DC 的，它没有必要再保留本地帐号了。\n2000 是个红叉，03 干脆就没有了。安装AD 时，会自动删除本地帐号，即使将来删除AD，也无法将本地帐号复原，而是重新\n生成的。这一点一定要注意：如果本地有EFS 加密的文件，一定要将证书导出或将文件解密后，再在这台计算机上做AD 安装实验。\n在2000 及以上计算机上登录到域的过程是这样的：域成员计算机根据本机DNS 配置去找DNS 服务器，DNS 根据SRV 记录告诉它DC 是谁，客户机联系DC，验证后登录。\n（3）深入讨论：\n如果是在林中跨域登录，是首先查询DNS 服务器，问林的GC 是谁。\n前面我们在步骤（1）中强调“加入域前，首先将客户机TCP/IP 配置中所配的DNS 服务器，指向DC 所用的DNS 服务器。＂其实如果域中有多个DNS 服务器，也可以指向其它的DNS 服务器，当然这些DNS 服务器之间得有区域复制关系。这样做的目的恰恰是：大中型网络为了平衡DNS 负载。\n三、建立其它域控制器\n前面我们讨论了“建立第一个域中的第一台域控制器＂，分析得很细。以下相同知识点的内容将不再赘述。\n1、安装附加DC\n（1）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。\n说明：\n将成为附加DC 的计算机，不必非得先加入域。DNS 指向已有DC 所用DNS 服务器，以便找到已有DC。安装结束后，一般应该手动在本\n机上再装一个DNS 服务器，以实现DNS 的容错。\n（2）选择：现有域的额外域控制器\n（3）输入域管理员帐号，如：administrator，password，mcse.com（或mcse）。常见找不到域的出错提示：域“mcse.com＂不是AD 域，或用于域的AD 域控制器无法联系上。\n解决：确保DNS 指向已有DC 所用DNS 的服务器。\n其它：Ping 一下，检查物理连通性。高级用户是否设过TCP/IP 筛选器或RRAS 筛选器。\n（4）输入域名，如：mcse.com。\n（5）指定AD 库和日志文件位置\n（6）指定sysvol 文件夹位置\n（7）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂\n（8）目录服务恢复模式的管理员密码\n（9）几分后，安装完成，需要重启。\n（10）手动在本机上安装DNS 服务器，以实现DNS 的容错。\nA、开始/设置/控制面板/添加删除程序/Windows 组件/网络服务/域名系统（DNS）。\nB、开始/程序/管理工具/DNS\nC、正向搜索区域/右键/新建区域，建议选择“AD 集成区域＂，区域名：已有区域的名称，\n如mcse.com。自动生成起始授权机构（SOA）、名称服务器（NS）、主机（A）三条记录，但此时SRV 记录并未被复制过来。需要等待5-15 分钟后，利用刷新或重新加载就可以看到复制过来的DNS 记录了（对于03 马上就可以看到复制过来的全部DNS 记录）。\n深入讨论：\n03 和2000 比，功能更强大了。但在域和AD 的体系结构上并没有什么大的变化，而且MS的产品十分讲究向前兼容。在一个域中可以既有2000DC，又有03DC；也可以既有2000DNS，又有03DNS，并且DC 间的AD 复制，DNS 间的区域传输，都好像没有版本差异一样。\n在我们这里要说的就是：2000 可作为03 域的附加DC，03 也可以作为2000 域的附加DC，但第二种情况需要在2000DC（SP2 及更高）上运行03 光盘/I386/adprep 命令来做准备。\n具体第一步：adprep /forestprep 进行林准备，第二步adprep /domainprep 进行域准备。\n2、建立子域\n（1）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。\n说明：\nDNS 指向林根域已有DC 所用DNS 服务器，以便找到已有DC。\n保证域命名主控必须有效，它默认在林根域的第一台DC 上，且具有林唯一性。利用管理工具“AD 域和信任关系＂可转移域命名主控。\n（2）选择：新域的域控制器，下一步，在现有的树中创建一个新的子域\n（3）输入林管理员帐号，如：administrator，password，mcse.com（或mcse）。常见出错提示：域“mcse.com＂不是AD 域，或用于域的AD 域控制器无法联系上。解决方法见前。\n（4）输入父域名，如：mcse.com；输入子域名，如sub，注意不要输成sub.mcse.com。\n（5）指定AD 库和日志文件位置\n（6）指定sysvol 文件夹位置\n（7）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂\n（8）目录服务恢复模式的管理员密码\n（9）几分后，安装完成，需要重启。\n如果域命名主控失效将会出现如下出错提示：“由于以下原因，操作失败：AD 无法与域\n命名主机xxx 联系。指定的服务器无法运行指定的操作。＂\n解决：保证域命名主控联机，如果确信其已无法正常工作，可强制传给林内的任意一个DC，子域的DC 也可以。原来的主机将必须被重做系统后，才可连入网络，以保证域命名主控的林唯一性。\n深入讨论：关于子域（子Domain）所对应的DNS 子区域（子zone）是否委派的问题。（以下简称：子区域）如果网络规模不是很大，虽然实现了子域，但总部、二级单位的网管可能就是同一个人。\n这种情况下就不需要委派了。可以把区域、子区域都放在同一个DNS 服务器上，由同一名管理员来管理就可以了。默认值即如此，不需要手动设置。如果网络规模较大，且二级单位需要能够控制自己的DNS 子区域，比如自己增加www1,www2……这样的主机记录；在自己的子区域下再建子区域。这种情况下就需要委派子区\n域了，由二级单位的DNS 管理员自己来管理。否则二级单位涉及DNS 的每一个小变化，都需要找总部DNS 管理员批准。\n子区域委派，操作步骤如下：（最好按如下步骤进行，不容易出问题）\nA、DNS 指向林根域（如：mcse.com）已有DC 所用DNS 服务器\nB、利用AD 安装向导，安装子域（如：sub.mcse.com），重启机。\nC、在林根DNS 控制台上查看，确保已在mcse.com 生成子文件夹sub，且sub 下有4 个以下划线开头的，保存有SRV 记录的子文件夹（_msdcs、_sites、_tcp、_udp）已生成；sub 下还应\n有如下2 条A 记录：（第二条记录如果未生成，手动补上也可以。）\n（与父文件夹相同）主机 IPSUBdc 主机 IP\nD、在父域（如：mcse.com）右键/新建委派/下一步/子区域名：sub。（不必担心重名，因为委派完成后，灰颜色的委派的sub 夹将取代黄颜色的sub 夹，但注意操作过程中会共存一段\n时间）接下来，指定负责子区域的名称服务器：SUBdc.sub.mcse.com 及它的IP，以生成粘合记录，下一步，完成。\nE、在子域DC 上安装DNS，操作：开始/设置/控制面板/添加删除程序/Windows 组件/网络服务/域名系统（DNS）。\nF、开始/程序/管理工具/DNS\nG、正向搜索区域/右键/新建区域，建议选择“AD 集成区域＂，区域名：sub.mcse.com。自\n动生成SOA、NS、A、A 四条记录（后两条A 记录，如C 步中述），此时SRV 记录也被复制过来了。\nH、在DNS 服务器的计算机名上/右键/属性/转发器：指向上一级或林根DNS 的IP。\nI、将子域DC 的DNS 指向自己，以后加入子域的计算机也使用子域的DNS，以实现DNS\n分担负荷。（当然，子域中的计算机可以使用林中任一台DNS，也都好使）\n注意：\n由上述过程，大家可以了解到，做为被委派的DNS 子区域的二级单位DNS 管理员，是不能随意更改自己的DNS 服务器的。比如修改DNS 服务器的IP，需要通知上级管理员，及时更新委派子区域的NS 记录，否则林中其它用户就会找不到你这个子域的计算机。\n3、新域—新树—加入林\n此种情况平常较少用到，因为一般企业只用一套命名体系，很少采用两上或两个以上的树。微软举的例子：一个大企业兼并另一企业，并且想保留它的命名体系，技术上对应实现就是目\n录树和DNS 名称空间。\n说明：此种应该预先建好DNS 正向搜索区，因为它不能像建子域那样，利用AD 向导自动\n在已有DNS 区域中创建子区域。下面以前文中的mcse.com，sub.mcse.com，my.com 图示为例进\n行说明。\n（1）在林根DNS 上，与mcse.com 并列，创建区域my.com，最好选AD 集成区域。\n（2）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。\n说明：\nDNS 指向林根域已有DC 所用DNS 服务器，并保证域命名主控必须有效。\n（3）选择：新域—新树—加入林\n（4）输入林管理员帐号，如：administrator，password，mcse.com（或mcse）。\n说明：\n输入的欲登录的林根域名，也就告诉了系统要加入哪个林。\n（5）输入新域的DNS 全名，如：my.com；域NetBIOS 名：MY。\n（6）指定AD 库和日志文件位置\n（7）指定sysvol 文件夹位置\n（8）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂\n（9）目录服务恢复模式的管理员密码\n（10）几分后，安装完成，需要重启。\n说明：\n用预建DNS 这种方式加入林，使用的是林根上已有DNS 服务器，所以此计算机在林根DNS的my.com 区域下，仅生成一条主机（A）记录（如需要可手动添加：treedc 主机 IP），SOA和NS 记录都是林根DNS 服务器，但在my.com 区域会有相应的SRV 记录来标识它是这个树根\n域的DC。这种并没有实现DNS 的分担负荷，如想实现，利用辅助区域来做。实验中发现：万不可像全新安装那样，在安装过程中，选择在本地安装一个DNS，这样将会这把个树根域安装成一个独立的林根域。原因吗？去问微软吧。\n四、卸载AD\n在实际工作中有时我们需要改变服务器角色，或者将实验中安装的DC 回复到普通成员/独立服务器身份，这就要进行AD 的卸载。\n1、卸载时会提示给新的本地管理员设置密码\n2、附加DC 卸载后，仍在域中。\n3、如果AD 不能卸载，应从以下几方面考虑：\n（1）权限\n权限要求与安装AD 类似，若一个林中只有一个域，那么你要卸载的就是林根域，需要林\n管理员权限；卸载附加DC 需要该域的域管理员权限；卸载子域或树，涉及到林结构的改变，\n也需要林管理员权限。\n（2）DNS\n一般应保证与安装时所用DNS 一致。如果做了DNS 规划，必须保证1 中权限所要求的管理员身份能找到相应DC 验证。\n（3）域命名主控\n卸载时只要涉及到林结构的改变，就需要保证域命名主控有效；卸载附加DC 时不要求域命名主控有效。但要注意的是：卸载时的出错信息与安装时的“AD 无法与域命名主机xxx 联系＂提示不同，具体是：由于以下原因，操作失败。以提供的凭据绑定到服务器xxx 失败。“RPC 服务器不可用＂。\n（4）卸载的顺序\n与安装顺序相反，应该先逐级卸载下面的子域，最后卸载树根域、林根域。否则将导致子域无法卸载，而存在的子域还有问题。因为极有可能此时架构和域命名主控及GC 未转移，林管理员组和架构管理员组（Schema\nAdmins）已经随林根域的删除而没有了。为什么这么说呢？因为如果管理员考虑到主控及GC等的转移问题，也就不会误删林根域了。\n五、从NT4 域升级到2000 域\n1、预备知识：\nNT4 域采用单主控复制，DC 分为PDC 和BDC，BDC 存储的只是PDC“目录服务数据库＂文件的只读复本。在“服务器管理器＂中可以将一台BDC 提升为PDC，原PDC 自动降为BDC。\n一个域中只能有一台PDC，零到多台BDC 以提供容错和分担负荷。但大家不要理解为一个网络中只能有一台PDC，域是逻辑分组，我们可以在一个子网中建多个域。\n2000 域开始采用多主控复制，DC 不再有PDC 和BDC 之分，DC 间的AD 复制是双向的。但2000 域中会唯一有一台DC 担当PDC 仿真主控，负责充当NT4 BDC 的PDC，并为早期版本\n客户机提供服务。PDC 仿真主控还负责管理运行NT、95/98 计算机的密码变化，写入AD。接受密码变化的DC 必须通知PDC 仿真主控，比如：用户登录时，如密码错误，必先送至PDC 仿真主控。因为普通DC 不能确认到底是密码错误，还是它没有及时与PDC 仿真主控同步。它还负责同步整个域中计算机的时间。通过以上我们可以知道：在2000 域中存在的NT4 域控制器，它的身份只能是BDC。\n2000 域模式分为：混合（mixed）模式和本机（natived）模式。默认为混合模式，如果管理员确认域中所有DC（注意：这里强调的是DC，2000 域本机模式下可以有NT4 的成员服务器）都是2000DC，没有NT4 的域控制器，可以手动在“AD 用户和计算机中＂将域模式更改为本机模式，以充分利用AD 的新功能，比如使用“通用组＂。\n通过以上分析，我们可以知道：如果在2000 域中存在NT4 域控制器，那么你只能使用2000域混合模式了。有人可能会想那我就不让它再当域控制器了，但是NT4 域的DC 和成员服务器之间角色转换必须重装NT4 系统，不能象2000 那样利用AD 安装向导，方便地进行安装/卸载。\n2、原则：由NT4 域向2000 域升级，第一个被升级的必须是NT4 域的PDC。这样才可以把帐号、安全设置、配置等带到2000 域\n3、MS 推荐策略：由于升级是一个极易出现各种问题的过程，必须考虑备份。再有就是实际操\n作时，可以先将NT4 的BDC 提升为PDC，再升级到2000。如果顺利的话，再升级其它BDC。\n如果不顺利的话，可将原来PDC 复原，以此方法来避免损失。\n4、深入讨论：我们可以把前面的问题再深入讨论一下，假设你的域中有NT4 的PDC，并且在它上面运行的老程序不允许你把它升级为2000，但你还想要通过升级NT4 域，得到2000 域，那么应该怎么办呢？答案很简单，可以先将这台PDC 降为BDC，再将新PDC 升级为2000。这样你既得到了2000 域，又保留了NT4 的BDC。\n5、我的推荐原则：在实际工作中，只要能进行2000 域的全新安装，就用全新安装。因为NT4\n升级后得到的2000 安全策略设置等等是继承NT4 时的设置，与2000 域的默认值有较大出入，\n以后出问题，不易排错，也不易与其它人交流沟通、解决问题。 ",
  "wordCount" : "651",
  "inLanguage": "en",
  "datePublished": "2006-12-09T16:28:55+08:00",
  "dateModified": "2006-12-09T16:28:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Seth"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "seth.dpdns.org/posts/windows%E7%9A%84%E5%9F%9F%E5%92%8C%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Seth Dang'S",
    "logo": {
      "@type": "ImageObject",
      "url": "seth.dpdns.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="seth.dpdns.org/" accesskey="h" title="Seth Dang&#39;S (Alt + H)">Seth Dang&#39;S</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      WINDOWS的域和活动目录
    </h1>
    <div class="post-meta"><span title='2006-12-09 16:28:55 +0800 +0800'>December 9, 2006</span>&nbsp;·&nbsp;Seth

</div>
  </header> 
  <div class="post-content"><p>一、认识Windows 的域<br>
本小节重点从理论上阐述域的概念、作用和Windows 中域的产生。<br>
一台Windows 计算机，它要么隶属于工作组，要么隶属于域。所以说到域，我们就不得不提一下工作组，工作组是MS 的概念，一般的普遍称谓是对等网。工作组通常是一个由不多于10 台计算机组成的逻辑集合，如果要管理更多的计算机，MS 推荐你使用域的模式进行集中管理，这样的管理更有效。你可以使用域、活动目录、组策略等等各种功能，使你网络管理的工作量达到最小。当然这里的10 台只是一个参考值，11 台甚至20 台，如果你不想进行集中的管理，那么你仍然可以使用工作组模式。工作组的特点就是实现简单，不需要域控制器DC，每台计算机自己管理自己，适用于距离很近的有限数目的计算机。另外工作组名并没有太多的实际意义，只是在网上邻居的列表中实现一个分组而已；再就是对于“计算机浏览服务＂，每一个工作组中，会自动推选出一个主浏览器，负责维护本工作组所有计算机的NetBIOS 名称列表。用户可以使用默认的workgroup，也可以任意起个名字，同一工作组或不同工作组在访问时也没有什么分别。域（Domain）是一个共用“目录服务数据库＂的计算机和用户的集合，实现起来要复杂一些，至少需要一台计算机安装NT/2000/03 Server 版本使其充当DC，来实现集中式的管理。若考虑到容错的话，至少需要两台。对于NT4 域就是一台PDC（具有唯一性），一至多台BDC，对于2000/03 域，已经没有PDC 和BDC 的概念，要容错就需要两至多台DC。域是逻辑分组，与网络的物理拓扑无关，可以很小，比如只有一台DC；也可以很大，包括遍布世界各地的计算机，比如大型跨国公司网络上的域（当然实际中他们多采用多域结构，还可以利用AD 站点来优化AD 复制）。这个“目录服务数据库＂，在NT4 时，保存用户帐号名称和密码等安全安全信息，以及安全规则设置，又被称作安全帐号管理（SAM）数据库，简称SAM 库。在非DC 上的本地的SAM库与DC 上域所用的SAM 库类似，只不过对于NT4 域的SAM 库文件，保存有整个域的用户和计算机，用“域用户管理器＂和“服务器管理器＂来管理，本地的SAM 库文件，保存有本地机的用户，由“用户管理器＂来管理。<br>
从2000 开始，MS 引入了活动目录AD，DC 通过AD 来提供目录的服务，例如它负责维护AD 数据库、审核用户的账户和密码是否正确、将AD 数据库复制到其它的DC 等。AD 库的核心文件就是winnt ntds ntds.dit 文件。注意组策略的具体设置值，并不存在这个文件中，而是保存在winnt sysvol sysvol 这个共享夹下，用于向其它DC 复制，传播给域成员，来生效。但需要说明的是：2000/XP/03 的非DC 域成员计算机上仍使用和NT4 一样的SAM 库文件来保存本地帐号。正是由于所有域成员计算机和域用户都共用这个域的“目录服务数据库＂，域管理员就可以基于域的“目录服务数据库＂来进行集中管理、共享资源，如用户、组、计算机帐号、权限设置、组策略设置等等。目录服务为管理员提供从网络上任何一个计算机上查看和管理用户和网络资源的能力。目录服务也为用户提供唯一的用户名和密码，用户只需一次登录，即可访问本域或有信任关系的其它域上的所有资源（当然用户得有权限才行），而不需要多次提供用户<br>
名和密码登录。<br>
二、构建Windows 2000 的域<br>
这个过程简单说就是：选一台2000S/AS 计算机，运行AD 安装向导，在其上安装活动目录，使其成为DC。然后将其它的计算机加入到这个域。<br>
说明：至于是用2000S，还是用2000AS，对于一般的用户差别不大。2000S 支持最多4 个<br>
CPU，最大4G 内存；2000AS 支持最多8 个CPU，最大内存8G，还支持群集功能。但这些我们一般用户都用不到，所以对于普通用户来说，选择S 或AS 都是一样的。<br>
1、系统要求<br>
*一台2000S 或2000AS 独立或成员服务器，2000DS 只有OEM 版，随厂商硬件发售，平常我们是见不到的。</p>
<ul>
<li>其上必须有一个NTFS 5.0 分区，用来保存AD 的sysvol 文件夹。注意：2000 的NTFS 分区是NTFS 5.0，NT4 的是NTFS 4.0，NT4 必须安装SP4 后，才可访问2000 的NTFS 分区。</li>
<li>网络上必须有可用的DNS 服务器，并且必须支持SRV 记录（Service Locaion Resource Record）和动态更新功能。如：MS Win2000S DNS，UNIX 的DNS BIND 8.12 及以上版本，使用已有的NT4 DNS 是不行的。<br>
说明：<br>
构建NT4 域并不需要DNS 的支持，但2000 域必须有DNS，且满足上述要求。SRV 记录的作用是指明域和站点（site）的DC、PDC 仿真、GC 是谁。动态更新也是2000DNS的新特色，管理员不必再象NT4 DNS 那样手动为计算机创建或修改相应记录，在域成员计算机<br>
重启，或改名、改IP 时依赖周期性更新，自动动态实现。<br>
如果没有DNS 服务器的话，也不一定非得预装DNS，可以在安装AD 过程中，选择在本机上安装2000 DNS。而且推荐初学者使用这种方法，因为系统会根据你提供的FQDN 域名，自动创建好DNS 区域（zone），并配置成AD 集成区域，仅安全动态更新。如果需要向外连或反向<br>
解析，用户只需配置上转发器和反向区域即可，不需要的话，直接就可以用了。如果决定在安装AD 过程中在本机安装DNS，应在安装前，将本机TCP/IP 配置/DNS 服务器指向自己，这样在安装AD 完成后重启时，SRV 记录将被自动注册到DNS 服务器的区域当中<br>
去的，生成四个以下划线开头的文件夹，如_msdcs，03DNS 在这里夹的层次结构有所变化，但本质没变。当然如果忘了指，也可以后补上，只不过需要多重启一次。<br>
2、安装步骤、注意事项、常见问题、经验技巧<br>
（1）启动AD 安装向导<br>
方法一：开始/程序/管理工具/配置服务器/ Active Directory /启动AD 安装向导。<br>
方法二：熟练后一般常用，开始/运行：dcpromo。<br>
（2）安装选项：指定服务器角色<br>
三个界面，实现四种组合：<br>
新域<br>
附加DC<br>
新树<br>
子域<br>
新林<br>
加入林<br>
即：</li>
<li>新域—新树—新林</li>
<li>附加DC</li>
<li>新域—子域</li>
<li>新域—新树—加入林<br>
全新安装：新域—新树—新林，这样来建立第一个域中的第一台DC。<br>
2000 的多域模型采用层次结构，不同于NT4 域的平面结构，NT4 的多个域之间只是通过信任关系关联起来。接下来以下图为例，对2000 的域、树、林进行简要说明：<br>
ms.com<br>
/<br>
trainning.mcse.com lotus.com<br>
这整个是一个林，ms.com 为林根域，有两个树，一个由ms.com 和它的子域trainning.ms.com组成，另一个由lotus.com 单独组成，林中有ms.com，trainning.ms.com，lotus.com 三个域。相关<br>
概念如下：<br>
林根域：在林中第一个建立的域，如：ms.com<br>
树：共用连续的命名空间的多层域，如ms.com 和trainning.ms.com<br>
树根域：树最高层的域，名最短。如：ms.com<br>
说明：<br>
2000 可采用多层域结构，但最有效、最简便的管理方法仍是单域，所以大家在实际工作中要记住一个原则“能用单域解决，就不用多域＂。再者2000AD 是针对大中型网络设计的，而我们一般管理的网络也就几百个节点，属于小型网络，一般来讲用一个单域结构就够用了，不要人为将管理环境复杂化。在实验中，我们甚至可以一个林中只有一个树，一个树中只有一个域，一个域里只有一台DC。<br>
另外前面已经说过了，域是逻辑分组，与网络的物理拓扑无关，不要总试图规划一个子网<br>
一个域。当然实际中多个子网一个域，子网中若有95/98/NT 老计算机，无法利用DNS 直接登录到域，可以安装一台WINS 服务器解决问题。将所有计算机，包括WINS 服务器本身的TCP/IP<br>
配置中的WINS 服务器指向此WINS 服务器即可。<br>
（3）安装选项：新域的DNS 全名<br>
说明：<br>
在这里应该输入新域的完全有效域名FQDN，形如：mcse.com。系统会打算以mcse 作为此<br>
域的NetBIOS 名称，并在网络中检查是否存在重名，需要等一会儿。不重名则设为mcse，建议用户不要修改此名；重名则设为mcse0，建议用户最好换个名字。这也就是说，网络中如果已有一个域，名字叫做mcse.org，也会出现NetBIOS 名称冲突的问题。<br>
（4）安装选项：为新域指定一个NetBIOS 名称<br>
说明：<br>
NetBIOS 名称，只是为95/98/NT 等老版本用户通过“浏览服务＂或WINS 来识别这个域用的，如果确信域用户都是2000 及以上系统（它们通过DNS 定位域），其实NetBIOS 名称冲不冲突，都无所谓。<br>
（5）安装选项：指定AD 库和日志文件位置<br>
说明：<br>
如果仅是实验，用默认值即可。若是在真正的服务器上，都会有多块物理硬盘，最好分开存放，以提高性能。另外需要强调的是：AD 库和日志文件并不要求非得NTFS 5.0 分区，很多2000/03 书在此语焉不详。<br>
（6）安装选项：指定sysvol 文件夹位置<br>
说明：<br>
是sysvol 这个文件夹要求必须得NTFS 5.0 分区。在它当中存储有DC 间AD 要同步的内容，包括组策略的设置值。<br>
（7）这时网络中若无可用DNS 服务器，就会出现提示：找不到DNS 服务器，需要考虑在本机上安装一个DNS 服务器。可先不必理会，点“确定＂，接下来选“是，在本机上安装并配置DNS＂。初学者在此不要选“否，我将自己安装并配置DNS＂。<br>
（8）几分后，安装完成，需要重启。<br>
说明：<br>
若硬盘或网络上没有可用的2000S 源文件，会提示要2000S 光盘。<br>
最好用新装2000S 来安装AD，这样不容易出问题。如果你是用一个台运行了一段时间的2000S/AS，来安装AD，使其成为DC。重启及登录时可能会很慢（有时可能长达20 分钟），这是较常见的现象。一般2-3 次以后就好了，如果多次重启后还那样，那就要重装系统及AD 了。<br>
3、域成员计算机<br>
（1）将计算机加入到域<br>
首先将客户机TCP/IP 配置中所配的DNS 服务器，指向DC 所用的DNS 服务器。然后我的<br>
电脑/右键/属性/网络标识/属性/隶属于，选择域：输入域名，确定。提示输入用户口和口令，确定后提示重启。<br>
说明：<br>
加入域时，如果输入的域名为FQDN 格式，形如mcse.com，必须利用DNS 中的SRV 记录<br>
来找到DC，如果客户机的DNS 指的不对，就无法加入到域。<br>
加入域时，如果输入的域名为NetBIOS 格式，如mcse，也可以利用浏览服务（广播方式）<br>
直接找到DC，但它不是一个完善的服务，有时就会不好使。<br>
这样虽然也可把计算机加入到域，而且在等较长时间后也可以登录到域上去，但不推荐。因为客户机的DNS 指的不对，则它无法利用2000DNS 的动态更新动能，也就是说无法在DNS区域中自动生成关于这台计算机的A 记录和PTR 记录。那么同一域另一子网的2000 及以上计算机就无法利用DNS 找到它，这本应是可以的。<br>
再者，管理员无法在客户机上利用域的管理工具来远程管理域，因为这些管理工具必须使用DNS，出错提示：找不到域命名信息（有时客户机的DNS Client 服务有问题也会出现上述提<br>
示，重启服务即可）。这种情况下，要进行远程管理，就只能利用TS（终端服务）基于IP 来连了。<br>
当然用户也可以手动配置WINS 或Lmhosts 文件，来查找DC。这主要用于95/98/NT 老版本计算机跨子网（路由）查找DC 或加入域，因为这些老版本计算机无法利用DNS 来查找DC，浏览服务又是广播方式，只能在本网段进行，因为广播信息是无法通过路由器的，RFC1542 标<br>
准的路由器，可设置成允许DHCP 的广播数据通过，仅是一个特例。需要说明的是：95/98 可以使用域用户帐号登录到域，但并不能加入到域，在AD 中也没有计算机帐号，而NT 可以。计算机加入域成功后，未重启，即已在AD 用户和计算机/computer 容器下生成计算机帐号<br>
了，实验中查看时，需要手动刷新一下。而在DNS 中记录必须在计算机重启后（不必登录）或15 分钟后才能自动注册或更新到DNS 区域。但若我们平常修改一个计算机的名字或IP，要马上更新到DNS 区域，倒不一定非得重启，可利用ipconfig /registerdns 命令就行。明白以上讨论可用于排错，不一定非得重启登录后才知道结果。<br>
加入到NT4 域时，需要有管理特权才行；从Windows 2000 开始，微软作了改进：在Windows2000/03 域中，默认Authenticated Users 即可在域中最多创建 10 个计算机帐户。Authenticated Users<br>
指被验证的用户组，也就是说任何经过身份验证的普通域用户都可以加最多10 台计算机到域。<br>
常见问题：在实际中用普通域帐号加计算机到域，有时会不好使，原因是同名计算机帐号（极<br>
可能是它自己已经失效的计算机帐号）已存在而无权覆盖，这时就得用域管理员帐号了。<br>
（2）在加入域的计算机上，用域用户帐号登录到域。<br>
说明：<br>
在域中的非DC 计算机上，可以选择登录到域或本机，这是因为它同时还拥有本地用户帐号。而在DC 上只能选择登录到域了，因为整个域都是DC 的，它没有必要再保留本地帐号了。<br>
2000 是个红叉，03 干脆就没有了。安装AD 时，会自动删除本地帐号，即使将来删除AD，也无法将本地帐号复原，而是重新<br>
生成的。这一点一定要注意：如果本地有EFS 加密的文件，一定要将证书导出或将文件解密后，再在这台计算机上做AD 安装实验。<br>
在2000 及以上计算机上登录到域的过程是这样的：域成员计算机根据本机DNS 配置去找DNS 服务器，DNS 根据SRV 记录告诉它DC 是谁，客户机联系DC，验证后登录。<br>
（3）深入讨论：<br>
如果是在林中跨域登录，是首先查询DNS 服务器，问林的GC 是谁。<br>
前面我们在步骤（1）中强调“加入域前，首先将客户机TCP/IP 配置中所配的DNS 服务器，指向DC 所用的DNS 服务器。＂其实如果域中有多个DNS 服务器，也可以指向其它的DNS 服务器，当然这些DNS 服务器之间得有区域复制关系。这样做的目的恰恰是：大中型网络为了平衡DNS 负载。<br>
三、建立其它域控制器<br>
前面我们讨论了“建立第一个域中的第一台域控制器＂，分析得很细。以下相同知识点的内容将不再赘述。<br>
1、安装附加DC<br>
（1）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。<br>
说明：<br>
将成为附加DC 的计算机，不必非得先加入域。DNS 指向已有DC 所用DNS 服务器，以便找到已有DC。安装结束后，一般应该手动在本<br>
机上再装一个DNS 服务器，以实现DNS 的容错。<br>
（2）选择：现有域的额外域控制器<br>
（3）输入域管理员帐号，如：administrator，password，mcse.com（或mcse）。常见找不到域的出错提示：域“mcse.com＂不是AD 域，或用于域的AD 域控制器无法联系上。<br>
解决：确保DNS 指向已有DC 所用DNS 的服务器。<br>
其它：Ping 一下，检查物理连通性。高级用户是否设过TCP/IP 筛选器或RRAS 筛选器。<br>
（4）输入域名，如：mcse.com。<br>
（5）指定AD 库和日志文件位置<br>
（6）指定sysvol 文件夹位置<br>
（7）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂<br>
（8）目录服务恢复模式的管理员密码<br>
（9）几分后，安装完成，需要重启。<br>
（10）手动在本机上安装DNS 服务器，以实现DNS 的容错。<br>
A、开始/设置/控制面板/添加删除程序/Windows 组件/网络服务/域名系统（DNS）。<br>
B、开始/程序/管理工具/DNS<br>
C、正向搜索区域/右键/新建区域，建议选择“AD 集成区域＂，区域名：已有区域的名称，<br>
如mcse.com。自动生成起始授权机构（SOA）、名称服务器（NS）、主机（A）三条记录，但此时SRV 记录并未被复制过来。需要等待5-15 分钟后，利用刷新或重新加载就可以看到复制过来的DNS 记录了（对于03 马上就可以看到复制过来的全部DNS 记录）。<br>
深入讨论：<br>
03 和2000 比，功能更强大了。但在域和AD 的体系结构上并没有什么大的变化，而且MS的产品十分讲究向前兼容。在一个域中可以既有2000DC，又有03DC；也可以既有2000DNS，又有03DNS，并且DC 间的AD 复制，DNS 间的区域传输，都好像没有版本差异一样。<br>
在我们这里要说的就是：2000 可作为03 域的附加DC，03 也可以作为2000 域的附加DC，但第二种情况需要在2000DC（SP2 及更高）上运行03 光盘/I386/adprep 命令来做准备。<br>
具体第一步：adprep /forestprep 进行林准备，第二步adprep /domainprep 进行域准备。<br>
2、建立子域<br>
（1）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。<br>
说明：<br>
DNS 指向林根域已有DC 所用DNS 服务器，以便找到已有DC。<br>
保证域命名主控必须有效，它默认在林根域的第一台DC 上，且具有林唯一性。利用管理工具“AD 域和信任关系＂可转移域命名主控。<br>
（2）选择：新域的域控制器，下一步，在现有的树中创建一个新的子域<br>
（3）输入林管理员帐号，如：administrator，password，mcse.com（或mcse）。常见出错提示：域“mcse.com＂不是AD 域，或用于域的AD 域控制器无法联系上。解决方法见前。<br>
（4）输入父域名，如：mcse.com；输入子域名，如sub，注意不要输成sub.mcse.com。<br>
（5）指定AD 库和日志文件位置<br>
（6）指定sysvol 文件夹位置<br>
（7）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂<br>
（8）目录服务恢复模式的管理员密码<br>
（9）几分后，安装完成，需要重启。<br>
如果域命名主控失效将会出现如下出错提示：“由于以下原因，操作失败：AD 无法与域<br>
命名主机xxx 联系。指定的服务器无法运行指定的操作。＂<br>
解决：保证域命名主控联机，如果确信其已无法正常工作，可强制传给林内的任意一个DC，子域的DC 也可以。原来的主机将必须被重做系统后，才可连入网络，以保证域命名主控的林唯一性。<br>
深入讨论：关于子域（子Domain）所对应的DNS 子区域（子zone）是否委派的问题。（以下简称：子区域）如果网络规模不是很大，虽然实现了子域，但总部、二级单位的网管可能就是同一个人。<br>
这种情况下就不需要委派了。可以把区域、子区域都放在同一个DNS 服务器上，由同一名管理员来管理就可以了。默认值即如此，不需要手动设置。如果网络规模较大，且二级单位需要能够控制自己的DNS 子区域，比如自己增加www1,www2……这样的主机记录；在自己的子区域下再建子区域。这种情况下就需要委派子区<br>
域了，由二级单位的DNS 管理员自己来管理。否则二级单位涉及DNS 的每一个小变化，都需要找总部DNS 管理员批准。<br>
子区域委派，操作步骤如下：（最好按如下步骤进行，不容易出问题）<br>
A、DNS 指向林根域（如：mcse.com）已有DC 所用DNS 服务器<br>
B、利用AD 安装向导，安装子域（如：sub.mcse.com），重启机。<br>
C、在林根DNS 控制台上查看，确保已在mcse.com 生成子文件夹sub，且sub 下有4 个以下划线开头的，保存有SRV 记录的子文件夹（_msdcs、_sites、_tcp、_udp）已生成；sub 下还应<br>
有如下2 条A 记录：（第二条记录如果未生成，手动补上也可以。）<br>
（与父文件夹相同）主机 IPSUBdc 主机 IP<br>
D、在父域（如：mcse.com）右键/新建委派/下一步/子区域名：sub。（不必担心重名，因为委派完成后，灰颜色的委派的sub 夹将取代黄颜色的sub 夹，但注意操作过程中会共存一段<br>
时间）接下来，指定负责子区域的名称服务器：SUBdc.sub.mcse.com 及它的IP，以生成粘合记录，下一步，完成。<br>
E、在子域DC 上安装DNS，操作：开始/设置/控制面板/添加删除程序/Windows 组件/网络服务/域名系统（DNS）。<br>
F、开始/程序/管理工具/DNS<br>
G、正向搜索区域/右键/新建区域，建议选择“AD 集成区域＂，区域名：sub.mcse.com。自<br>
动生成SOA、NS、A、A 四条记录（后两条A 记录，如C 步中述），此时SRV 记录也被复制过来了。<br>
H、在DNS 服务器的计算机名上/右键/属性/转发器：指向上一级或林根DNS 的IP。<br>
I、将子域DC 的DNS 指向自己，以后加入子域的计算机也使用子域的DNS，以实现DNS<br>
分担负荷。（当然，子域中的计算机可以使用林中任一台DNS，也都好使）<br>
注意：<br>
由上述过程，大家可以了解到，做为被委派的DNS 子区域的二级单位DNS 管理员，是不能随意更改自己的DNS 服务器的。比如修改DNS 服务器的IP，需要通知上级管理员，及时更新委派子区域的NS 记录，否则林中其它用户就会找不到你这个子域的计算机。<br>
3、新域—新树—加入林<br>
此种情况平常较少用到，因为一般企业只用一套命名体系，很少采用两上或两个以上的树。微软举的例子：一个大企业兼并另一企业，并且想保留它的命名体系，技术上对应实现就是目<br>
录树和DNS 名称空间。<br>
说明：此种应该预先建好DNS 正向搜索区，因为它不能像建子域那样，利用AD 向导自动<br>
在已有DNS 区域中创建子区域。下面以前文中的mcse.com，sub.mcse.com，my.com 图示为例进<br>
行说明。<br>
（1）在林根DNS 上，与mcse.com 并列，创建区域my.com，最好选AD 集成区域。<br>
（2）以本机管理员身份登录，在独立或成员服务器上，启动AD 安装向导。<br>
说明：<br>
DNS 指向林根域已有DC 所用DNS 服务器，并保证域命名主控必须有效。<br>
（3）选择：新域—新树—加入林<br>
（4）输入林管理员帐号，如：administrator，password，mcse.com（或mcse）。<br>
说明：<br>
输入的欲登录的林根域名，也就告诉了系统要加入哪个林。<br>
（5）输入新域的DNS 全名，如：my.com；域NetBIOS 名：MY。<br>
（6）指定AD 库和日志文件位置<br>
（7）指定sysvol 文件夹位置<br>
（8）一般选：“与Windows 2000 服务器之前的版本相兼容的权限＂<br>
（9）目录服务恢复模式的管理员密码<br>
（10）几分后，安装完成，需要重启。<br>
说明：<br>
用预建DNS 这种方式加入林，使用的是林根上已有DNS 服务器，所以此计算机在林根DNS的my.com 区域下，仅生成一条主机（A）记录（如需要可手动添加：treedc 主机 IP），SOA和NS 记录都是林根DNS 服务器，但在my.com 区域会有相应的SRV 记录来标识它是这个树根<br>
域的DC。这种并没有实现DNS 的分担负荷，如想实现，利用辅助区域来做。实验中发现：万不可像全新安装那样，在安装过程中，选择在本地安装一个DNS，这样将会这把个树根域安装成一个独立的林根域。原因吗？去问微软吧。<br>
四、卸载AD<br>
在实际工作中有时我们需要改变服务器角色，或者将实验中安装的DC 回复到普通成员/独立服务器身份，这就要进行AD 的卸载。<br>
1、卸载时会提示给新的本地管理员设置密码<br>
2、附加DC 卸载后，仍在域中。<br>
3、如果AD 不能卸载，应从以下几方面考虑：<br>
（1）权限<br>
权限要求与安装AD 类似，若一个林中只有一个域，那么你要卸载的就是林根域，需要林<br>
管理员权限；卸载附加DC 需要该域的域管理员权限；卸载子域或树，涉及到林结构的改变，<br>
也需要林管理员权限。<br>
（2）DNS<br>
一般应保证与安装时所用DNS 一致。如果做了DNS 规划，必须保证1 中权限所要求的管理员身份能找到相应DC 验证。<br>
（3）域命名主控<br>
卸载时只要涉及到林结构的改变，就需要保证域命名主控有效；卸载附加DC 时不要求域命名主控有效。但要注意的是：卸载时的出错信息与安装时的“AD 无法与域命名主机xxx 联系＂提示不同，具体是：由于以下原因，操作失败。以提供的凭据绑定到服务器xxx 失败。“RPC 服务器不可用＂。<br>
（4）卸载的顺序<br>
与安装顺序相反，应该先逐级卸载下面的子域，最后卸载树根域、林根域。否则将导致子域无法卸载，而存在的子域还有问题。因为极有可能此时架构和域命名主控及GC 未转移，林管理员组和架构管理员组（Schema<br>
Admins）已经随林根域的删除而没有了。为什么这么说呢？因为如果管理员考虑到主控及GC等的转移问题，也就不会误删林根域了。<br>
五、从NT4 域升级到2000 域<br>
1、预备知识：<br>
NT4 域采用单主控复制，DC 分为PDC 和BDC，BDC 存储的只是PDC“目录服务数据库＂文件的只读复本。在“服务器管理器＂中可以将一台BDC 提升为PDC，原PDC 自动降为BDC。<br>
一个域中只能有一台PDC，零到多台BDC 以提供容错和分担负荷。但大家不要理解为一个网络中只能有一台PDC，域是逻辑分组，我们可以在一个子网中建多个域。<br>
2000 域开始采用多主控复制，DC 不再有PDC 和BDC 之分，DC 间的AD 复制是双向的。但2000 域中会唯一有一台DC 担当PDC 仿真主控，负责充当NT4 BDC 的PDC，并为早期版本<br>
客户机提供服务。PDC 仿真主控还负责管理运行NT、95/98 计算机的密码变化，写入AD。接受密码变化的DC 必须通知PDC 仿真主控，比如：用户登录时，如密码错误，必先送至PDC 仿真主控。因为普通DC 不能确认到底是密码错误，还是它没有及时与PDC 仿真主控同步。它还负责同步整个域中计算机的时间。通过以上我们可以知道：在2000 域中存在的NT4 域控制器，它的身份只能是BDC。<br>
2000 域模式分为：混合（mixed）模式和本机（natived）模式。默认为混合模式，如果管理员确认域中所有DC（注意：这里强调的是DC，2000 域本机模式下可以有NT4 的成员服务器）都是2000DC，没有NT4 的域控制器，可以手动在“AD 用户和计算机中＂将域模式更改为本机模式，以充分利用AD 的新功能，比如使用“通用组＂。<br>
通过以上分析，我们可以知道：如果在2000 域中存在NT4 域控制器，那么你只能使用2000域混合模式了。有人可能会想那我就不让它再当域控制器了，但是NT4 域的DC 和成员服务器之间角色转换必须重装NT4 系统，不能象2000 那样利用AD 安装向导，方便地进行安装/卸载。<br>
2、原则：由NT4 域向2000 域升级，第一个被升级的必须是NT4 域的PDC。这样才可以把帐号、安全设置、配置等带到2000 域<br>
3、MS 推荐策略：由于升级是一个极易出现各种问题的过程，必须考虑备份。再有就是实际操<br>
作时，可以先将NT4 的BDC 提升为PDC，再升级到2000。如果顺利的话，再升级其它BDC。<br>
如果不顺利的话，可将原来PDC 复原，以此方法来避免损失。<br>
4、深入讨论：我们可以把前面的问题再深入讨论一下，假设你的域中有NT4 的PDC，并且在它上面运行的老程序不允许你把它升级为2000，但你还想要通过升级NT4 域，得到2000 域，那么应该怎么办呢？答案很简单，可以先将这台PDC 降为BDC，再将新PDC 升级为2000。这样你既得到了2000 域，又保留了NT4 的BDC。<br>
5、我的推荐原则：在实际工作中，只要能进行2000 域的全新安装，就用全新安装。因为NT4<br>
升级后得到的2000 安全策略设置等等是继承NT4 时的设置，与2000 域的默认值有较大出入，<br>
以后出问题，不易排错，也不易与其它人交流沟通、解决问题。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="seth.dpdns.org/">Seth Dang&#39;S</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
