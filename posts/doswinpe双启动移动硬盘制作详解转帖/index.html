<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DOS/WinPE双启动移动硬盘制作详解（转帖） | Seth Dang&#39;S</title>
<meta name="keywords" content="">
<meta name="description" content="DOS/WinPE双启动移动硬盘制作详解
2008-04-23 10:46
[ 2007-5-5 5:03:00 | By: icbchnzf ]
很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”
NT Loader &#43; AVLDR &#43; Avlgo
MBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。
工具准备：
PeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。
数据准备：
1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。
2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。
3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。
4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。
5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。
开始组装：
1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：
[boot loader]
timeout=30
default=C:\avldr.xpe
[operating systems]
C:\avldr.xpe=&ldquo;Windows PE&rdquo;
C:\avldr.bin=&ldquo;MS-DOS 7.1 form USB-HDD&rdquo;
C:\avldr.dos=&ldquo;MS-DOS 7.1 from USB-FDD&rdquo;
完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib &#43;r &#43;s &#43;h boot.ini 修改文件属性）。
这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\avldr.xpe，启动WinPE。
[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。
2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。">
<meta name="author" content="Seth">
<link rel="canonical" href="seth.dpdns.org/posts/doswinpe%E5%8F%8C%E5%90%AF%E5%8A%A8%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%E5%88%B6%E4%BD%9C%E8%AF%A6%E8%A7%A3%E8%BD%AC%E5%B8%96/">
<link crossorigin="anonymous" href="seth.dpdns.org/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css" integrity="sha256-4fXEyuRFmWVff/lRlf&#43;JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as="style">
<link rel="icon" href="seth.dpdns.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="seth.dpdns.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="seth.dpdns.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="seth.dpdns.org/apple-touch-icon.png">
<link rel="mask-icon" href="seth.dpdns.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="seth.dpdns.org/posts/doswinpe%E5%8F%8C%E5%90%AF%E5%8A%A8%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%E5%88%B6%E4%BD%9C%E8%AF%A6%E8%A7%A3%E8%BD%AC%E5%B8%96/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="seth.dpdns.org/posts/doswinpe%E5%8F%8C%E5%90%AF%E5%8A%A8%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%E5%88%B6%E4%BD%9C%E8%AF%A6%E8%A7%A3%E8%BD%AC%E5%B8%96/">
  <meta property="og:site_name" content="Seth Dang&#39;S">
  <meta property="og:title" content="DOS/WinPE双启动移动硬盘制作详解（转帖）">
  <meta property="og:description" content="DOS/WinPE双启动移动硬盘制作详解
2008-04-23 10:46
[ 2007-5-5 5:03:00 | By: icbchnzf ]
很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”
NT Loader &#43; AVLDR &#43; Avlgo
MBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。
工具准备：
PeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。
数据准备：
1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。
2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。
3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。
4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。
5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。
开始组装：
1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：
[boot loader]
timeout=30
default=C:\avldr.xpe
[operating systems]
C:\avldr.xpe=“Windows PE”
C:\avldr.bin=“MS-DOS 7.1 form USB-HDD”
C:\avldr.dos=“MS-DOS 7.1 from USB-FDD”
完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib &#43;r &#43;s &#43;h boot.ini 修改文件属性）。
这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\avldr.xpe，启动WinPE。
[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。
2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2008-08-07T14:42:47+08:00">
    <meta property="article:modified_time" content="2008-08-07T14:42:47+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DOS/WinPE双启动移动硬盘制作详解（转帖）">
<meta name="twitter:description" content="DOS/WinPE双启动移动硬盘制作详解
2008-04-23 10:46
[ 2007-5-5 5:03:00 | By: icbchnzf ]
很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”
NT Loader &#43; AVLDR &#43; Avlgo
MBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。
工具准备：
PeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。
数据准备：
1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。
2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。
3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。
4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。
5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。
开始组装：
1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：
[boot loader]
timeout=30
default=C:\avldr.xpe
[operating systems]
C:\avldr.xpe=&ldquo;Windows PE&rdquo;
C:\avldr.bin=&ldquo;MS-DOS 7.1 form USB-HDD&rdquo;
C:\avldr.dos=&ldquo;MS-DOS 7.1 from USB-FDD&rdquo;
完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib &#43;r &#43;s &#43;h boot.ini 修改文件属性）。
这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\avldr.xpe，启动WinPE。
[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。
2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "seth.dpdns.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "DOS/WinPE双启动移动硬盘制作详解（转帖）",
      "item": "seth.dpdns.org/posts/doswinpe%E5%8F%8C%E5%90%AF%E5%8A%A8%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%E5%88%B6%E4%BD%9C%E8%AF%A6%E8%A7%A3%E8%BD%AC%E5%B8%96/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DOS/WinPE双启动移动硬盘制作详解（转帖）",
  "name": "DOS\/WinPE双启动移动硬盘制作详解（转帖）",
  "description": "DOS/WinPE双启动移动硬盘制作详解\n2008-04-23 10:46\n[ 2007-5-5 5:03:00 | By: icbchnzf ]\n很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”\nNT Loader + AVLDR + Avlgo\nMBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。\n工具准备：\nPeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。\n数据准备：\n1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。\n2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。\n3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。\n4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。\n5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。\n开始组装：\n1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：\n[boot loader]\ntimeout=30\ndefault=C:\\avldr.xpe\n[operating systems]\nC:\\avldr.xpe=\u0026ldquo;Windows PE\u0026rdquo;\nC:\\avldr.bin=\u0026ldquo;MS-DOS 7.1 form USB-HDD\u0026rdquo;\nC:\\avldr.dos=\u0026ldquo;MS-DOS 7.1 from USB-FDD\u0026rdquo;\n完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib +r +s +h boot.ini 修改文件属性）。\n这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\\avldr.xpe，启动WinPE。\n[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。\n2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。\n",
  "keywords": [
    
  ],
  "articleBody": "DOS/WinPE双启动移动硬盘制作详解\n2008-04-23 10:46\n[ 2007-5-5 5:03:00 | By: icbchnzf ]\n很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”\nNT Loader + AVLDR + Avlgo\nMBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。\n工具准备：\nPeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。\n数据准备：\n1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。\n2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。\n3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。\n4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。\n5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。\n开始组装：\n1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：\n[boot loader]\ntimeout=30\ndefault=C:\\avldr.xpe\n[operating systems]\nC:\\avldr.xpe=“Windows PE”\nC:\\avldr.bin=“MS-DOS 7.1 form USB-HDD”\nC:\\avldr.dos=“MS-DOS 7.1 from USB-FDD”\n完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib +r +s +h boot.ini 修改文件属性）。\n这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\\avldr.xpe，启动WinPE。\n[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。\n2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。\n3、把下载到的老毛桃WinPE的ISO文件解压缩到一个临时文件夹，把其中“WINPE安装”文件夹里面的AVLDR.XPE拷贝到U盘的根目录，把“WXPE”文件夹下的 SETUPLDR.BIN 也拷贝到U盘根目录并改文件名为 LDRXPE。把临时文件夹里面的 WINNT.XPE、WINPE.IS_、和“外置程序”文件夹都拷贝到 U 盘的根目录下。做完这一步，U盘就可以引导到WinPE下了。如果启动的时候选第一项“Windows PE By 420){this.resized=true;this.style.width=420;}\" border=0 smilieid=“10”\u003eaoMaotao”，系统将依照NTLDR——\u003eavldr.xpe——\u003ewinnt.xpe——\u003ewinpe.is_这个顺序链把电脑启动到Windows PE环境下。\n5、把软盘镜像文件DOS.ima拷贝到U盘根目录。\n6、把前面生成的Avldr.bin和Avlgo.sys两个文件拷贝到U盘根目录，对照Boot.ini文件可知，这两个文件是对应于菜单中第二行 for USB-HDD模式。如果启动的时候选择第二项“MS-DOS 7.1 form USB-HDD”，系统将依照NTLDR——\u003eavldr.bin——\u003eavlgo.sys——\u003eDOS.ima这个顺序链把电脑启动到MS-DOS环境下。\n7、把前面UltraEdit编辑生成的Avldr.dos和Avdos.sys两个文件拷贝到U盘根目录，对照Boot.ini文件可知，这两个文件是对应于菜单中第三行 for USB-FDD模式。如果启动的时候选择第三项“MS-DOS 7.1 form USB-FDD”，系统将依照NTLDR——\u003eavldr.dos——\u003eavdos.sys——\u003eDOS.ima这个顺序链把电脑启动到MS-DOS环境下。\n至此DOS/WinPE双启动系统维护U盘制作成功。\n",
  "wordCount" : "98",
  "inLanguage": "en",
  "datePublished": "2008-08-07T14:42:47+08:00",
  "dateModified": "2008-08-07T14:42:47+08:00",
  "author":{
    "@type": "Person",
    "name": "Seth"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "seth.dpdns.org/posts/doswinpe%E5%8F%8C%E5%90%AF%E5%8A%A8%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%E5%88%B6%E4%BD%9C%E8%AF%A6%E8%A7%A3%E8%BD%AC%E5%B8%96/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Seth Dang'S",
    "logo": {
      "@type": "ImageObject",
      "url": "seth.dpdns.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="seth.dpdns.org/" accesskey="h" title="Seth Dang&#39;S (Alt + H)">Seth Dang&#39;S</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      DOS/WinPE双启动移动硬盘制作详解（转帖）
    </h1>
    <div class="post-meta"><span title='2008-08-07 14:42:47 +0800 +0800'>August 7, 2008</span>&nbsp;·&nbsp;Seth

</div>
  </header> 
  <div class="post-content"><p>DOS/WinPE双启动移动硬盘制作详解</p>
<p>2008-04-23 10:46</p>
<p>[ 2007-5-5 5:03:00 | By: icbchnzf ]<br>
很多年以前，那时候软驱还是电脑的必配，维护电脑引导系统也用软盘，我那时候就做了N片启动软盘。后来随着软盘淡出市场，系统维护盘也改用光盘了，例如著名的深山红叶系统维护工具盘，就为我的工作提供了有力的帮助。不过光盘还是存在容易磨花，体积较大等缺点。现在的电脑基本上都支持USB设备启动，U盘可以做成小巧而容易携带的系统维护盘；可重写的存储媒体也为更新提供了方便，再也不用为了升级刻录一堆光盘了。目标：对于系统维护来说，WindowsPE不可却少的利器；除此外，有一些问题还是需要启动到DOS环境来解决。所以我的目标就是制作一个DOS/WinPE双启动的系统维护U盘。下次再遇到某电脑系统崩溃的话，从衣袋里面摸出一精致的U盘，启动电脑之后，把问题解决于弹指间。何其潇洒也！技术背景：其实，U盘启动电脑，主要是各种引导工具的合理灵活运用，所有的操作和调试，也都是围绕引导工具的安装和配置进行的。我们知道，作为操作系统的主要载体，磁盘一直是最重要的存储媒质。因此基本上所有的OS引导的模式都大致相同，都是由磁盘来装入的。首先，需要在OS所在磁盘的MBR（主引导记录）扇区写入特定的引导代码，电脑启动后会按照BIOS里面设置的启动顺序轮询对应磁盘的MBR区，如果找到有效的MBR记录，就按照MBR记录的指针去装入OS引导文件，如果OS引导文件正常，就加载对应的操作系统。因此完成一个操作系统的启动，需要两个必须的步骤：1、MBR引导；2、OS引导。基于上述基本原理，各种操作系统都有自带的引导器，例如WindowsNT以上系统的NT Loader（NTLDR）、Linux的Lilo、各版本的Grub引导器等等，当然还有一些第三方的多系统引导工具如System Commander等等。对于我们目前的这个应用，目的是能够在U盘上实现DOS/WinPE双启动，并且具有相对比较好的兼容性。要达到这个目的，就有一些技术要求。首先，方案要能够适应U盘移动存储这种盘符变动的情况；其次，要实现双启动，一般都会用到虚拟盘镜像，也就是引导器需要支持RAMDisk加载各种常见磁盘镜像启动的方式。虽然U盘具有小巧轻量并且可以反复擦写等诸多优点，但如果要做成启动盘，还存在一些需要解决的问题。最大的问题是：USB启动并没有统一的行业规范。主板制造商不同、BIOS不同，USB引导方式也有差异。作为移动存储设备，主板对U盘的识别不同，会使盘符变化。这些直接导致U盘启动的通用性和兼容性不理想，表现就是在有些电脑上无法引导。这是需要重点解决的问题。OS选择：DOS系统选用MS-DOS 7.1；WinPE选用无忧论坛老毛桃的“外置网络、多媒体组件的老九 WinPE 老毛桃最终修改版”</p>
<p>NT Loader + AVLDR + Avlgo</p>
<p>MBR用NT Loader引导，在NTLDR引导菜单中设置选项：用AVLDR引导WinPE；而用Avlgo引导DOS；由于Avlgo不支持选单方式多重启动，为了解决不同主板识别U盘的盘符不同的问题，对Avlgo引导配置文件稍作修改，以适应盘符变化的启动需求。</p>
<p>工具准备：<br>
PeToUsb——用来把U盘格式化成NT引导模式；WinImage——用于制作DOS启动软盘镜像；Avlgomgr——用于生成Avlgo引导文件；UltraEdit——用于编辑修改Avlgo的引导文件。</p>
<p>数据准备：<br>
1、PeToUSB是一款免费软件，专门用来把U盘引导区格式化成NTLDR引导代码。启动PeToUSB，从“Destination Driver”栏选择目标U盘，点击下面的“Start”按钮，它询问“Continue”是否继续，点击“是”，弹出一个警告窗口，提示目标盘的所有数据都将会丢失，是否继续？还是选择“是”，然后片刻就完成格式化。<br>
2、用WinImage制作一个2.88M的启动软盘镜像，将MS-DOS 7.1装入镜像，并把常用的DOS工具也放到镜像里面。启动WinImage后，点击最左边的按钮新建一个镜像，这里选择标准格式2.88MB，为的是尽量能多存放一些工具。然后向这个镜像中添加文件，把事先准备好的MS-DOS系统文件从资源管理器里面拖拽到WinImage窗口中。其它DOS工具也这样添加进来。文件添加完毕之后，点击“映像”菜单——“引导扇区属性”，选择“Windows 95/98”并确定，这一步很重要，漏做这一步的话，这个软盘镜像就不能引导电脑了。最后保存成ima格式的镜像文件DOS.ima。<br>
3、、先备份好C盘的Boot.ini文件，注意默认状态看不到这个系统、隐藏属性的文件，需要到资源管理器里面“工具”菜单“文件夹选项”当中修改查看方式，取消“隐藏受保护的操作系统文件”复选框，并切换为显示所有文件。启动Avlgomgr，在“虚拟磁盘完整路径”浏览找到刚才用WinImage制作的镜像文件，然后点击“装配”按钮，Avlgomgr自动修改Boot.ini文件，并在目标盘（本例为C盘）生成我们需要的Avldr.bin和Avlgo.sys两个关键文件，把这两个文件拷贝到某处备用。完成以后恢复原C盘的Boot.ini文件。<br>
4、启动UltraEdit，先打开Avldr.bin，在编辑屏右边的ASCⅡ码区域可以找到“AVLGO.SYS”的字符串，把它改成“AVDOS.SYS”，文件另存为Avldr.dos。<br>
5、然后打开Avlgo.sys，在右边ASCⅡ码区域找“(hd0,0)/DOS.IMA”字符串，把它修改成“(fd0)/DOS.IMA”。修改的时候要注意，由于修改后的字符串比修改前的短，为保证文件长度不变，剩下的部分要切换到左边16进制码区域，用“00”填充，这样才能保证文件长度不变。修改完后另存为Avdos.sys。<br>
开始组装：</p>
<p>1、首先，在U盘的根目录用记事本创建一个Boot.ini文件，内容如下：<br>
[boot loader]<br>
timeout=30<br>
default=C:\avldr.xpe<br>
[operating systems]<br>
C:\avldr.xpe=&ldquo;Windows PE&rdquo;<br>
C:\avldr.bin=&ldquo;MS-DOS 7.1 form USB-HDD&rdquo;<br>
C:\avldr.dos=&ldquo;MS-DOS 7.1 from USB-FDD&rdquo;<br>
完成以后把这个文件的属性修改成 只读/系统/隐藏（可以用DOS命令 attrib +r +s +h boot.ini 修改文件属性）。<br>
这是NT Loader的菜单配置文件，timeout参数设置的是说サ却 奔洌 绻 谏瓒ǖ氖奔洌ū纠 ?0秒）用户没有进行选择，就自动加载default项默认的C:\avldr.xpe，启动WinPE。<br>
[operating systems]小节是菜单中出现的引导选项，第一个就是前面default设置的老毛桃WinPE，双引号里面的是注释行，会显示在引导菜单里面。下面两行分别是为主板识别U盘为USB-HDD和主板识别U盘为USB-FDD两种模式对应的引导项。</p>
<p>2、把硬盘系统的NTLDR和NTDETECT.COM两个文件拷贝到U盘根目录，这是NT Loader引导器的必须文件。</p>
<p>3、把下载到的老毛桃WinPE的ISO文件解压缩到一个临时文件夹，把其中“WINPE安装”文件夹里面的AVLDR.XPE拷贝到U盘的根目录，把“WXPE”文件夹下的 SETUPLDR.BIN 也拷贝到U盘根目录并改文件名为 LDRXPE。把临时文件夹里面的 WINNT.XPE、WINPE.IS_、和“外置程序”文件夹都拷贝到 U 盘的根目录下。做完这一步，U盘就可以引导到WinPE下了。如果启动的时候选第一项“Windows PE By 420){this.resized=true;this.style.width=420;}&quot; border=0 smilieid=&ldquo;10&rdquo;&gt;aoMaotao”，系统将依照NTLDR&mdash;&mdash;&gt;avldr.xpe&mdash;&mdash;&gt;winnt.xpe&mdash;&mdash;&gt;winpe.is_这个顺序链把电脑启动到Windows PE环境下。</p>
<p>5、把软盘镜像文件DOS.ima拷贝到U盘根目录。</p>
<p>6、把前面生成的Avldr.bin和Avlgo.sys两个文件拷贝到U盘根目录，对照Boot.ini文件可知，这两个文件是对应于菜单中第二行 for USB-HDD模式。如果启动的时候选择第二项“MS-DOS 7.1 form USB-HDD”，系统将依照NTLDR&mdash;&mdash;&gt;avldr.bin&mdash;&mdash;&gt;avlgo.sys&mdash;&mdash;&gt;DOS.ima这个顺序链把电脑启动到MS-DOS环境下。</p>
<p>7、把前面UltraEdit编辑生成的Avldr.dos和Avdos.sys两个文件拷贝到U盘根目录，对照Boot.ini文件可知，这两个文件是对应于菜单中第三行 for USB-FDD模式。如果启动的时候选择第三项“MS-DOS 7.1 form USB-FDD”，系统将依照NTLDR&mdash;&mdash;&gt;avldr.dos&mdash;&mdash;&gt;avdos.sys&mdash;&mdash;&gt;DOS.ima这个顺序链把电脑启动到MS-DOS环境下。</p>
<p>至此DOS/WinPE双启动系统维护U盘制作成功。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="seth.dpdns.org/">Seth Dang&#39;S</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
